<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Your Financial Plan - MasterPlan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        body {
            background: linear-gradient(to bottom, #fafbfc 0%, #ffffff 100%);
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-selectable {
            border: 2px solid #e5e7eb;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            border-radius: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        .card-selectable:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.1);
        }
        .card-selectable.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        .search-dropdown {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-top: none;
            position: absolute;
            width: 100%;
            background-color: white;
            z-index: 10;
            border-radius: 0 0 0.75rem 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .search-result {
            border-bottom: 1px solid #f3f4f6;
            padding: 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        .search-result:hover {
            background-color: #f9fafb;
        }
        .selected-program {
            border: 2px solid #667eea;
            padding: 1.5rem;
            background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);
            position: relative;
            border-radius: 1rem;
        }
        .remove-program {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            cursor: pointer;
            color: #ef4444;
            font-weight: bold;
            font-size: 1.5rem;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }
        .remove-program:hover {
            background: #fee2e2;
        }
        .step-indicator {
            font-size: 1rem;
            font-weight: 600;
            color: #9ca3af;
            position: relative;
            padding: 0.5rem 1rem;
        }
        .step-indicator.active {
            color: #667eea;
        }
        .step-indicator.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px 3px 0 0;
        }
        input[type="text"],
        input[type="number"] {
            border: 2px solid #e5e7eb;
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s;
        }
        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .auth-modal {
            background: white;
            border-radius: 1.5rem;
            padding: 3rem;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
    </style>
    <!-- Hotjar Tracking Code for https://masterplan-92uay74xk-sebbs21s-projects.vercel.app/ -->
    <script type="module">
        import Hotjar from 'https://cdn.jsdelivr.net/npm/@hotjar/browser@1.0.0/dist/index.js';
        const siteId = 6573027;
        const hotjarVersion = 6;
        Hotjar.init(siteId, hotjarVersion);
    </script>
    <script>
        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', function() {
            const user = localStorage.getItem('masterplan_user');
            
            // Update navigation based on auth status
            const navUser = document.querySelector('nav .flex.items-center.space-x-8 .flex.items-center.space-x-3');
            if (navUser) {
                if (user) {
                    const userData = JSON.parse(user);
                    const firstLetter = userData.name ? userData.name.charAt(0).toUpperCase() : 'U';
                    navUser.innerHTML = `
                        <div class="w-10 h-10 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold">
                            ${firstLetter}
                        </div>
                        <span class="font-semibold text-gray-900">${userData.name || 'User'}</span>
                    `;
                } else {
                    navUser.innerHTML = `
                        <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 font-semibold">
                            G
                        </div>
                        <span class="font-medium text-gray-700">Guest</span>
                    `;
                }
            }
            
            // Show auth overlay if not logged in
            if (!user) {
                const mainContent = document.getElementById('main-content');
                if (mainContent) {
                    mainContent.style.opacity = '0.3';
                    mainContent.style.pointerEvents = 'none';
                }
                
                const overlay = document.createElement('div');
                overlay.className = 'auth-overlay';
                overlay.innerHTML = `
                    <div class="auth-modal text-center">
                        <div class="w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-full mx-auto mb-6 flex items-center justify-center">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-900 mb-3">Create Your Account First</h2>
                        <p class="text-gray-600 mb-8">To start creating your financial plan, please create a free account. It only takes a minute!</p>
                        <div class="space-y-3">
                            <a href="signupmodal.html" class="gradient-bg text-white px-8 py-4 rounded-xl font-semibold hover:shadow-2xl transition-all transform hover:-translate-y-1 inline-block w-full">
                                Create Free Account
                            </a>
                            <button onclick="this.closest('.auth-overlay').remove(); document.getElementById('main-content').style.opacity = '1'; document.getElementById('main-content').style.pointerEvents = 'auto';" class="text-gray-600 hover:text-gray-900 font-medium">
                                Maybe Later
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(overlay);
            }
        });
    </script>
</head>
<body class="antialiased">
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-md border-b border-gray-100 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <a href="index.html" class="text-2xl font-bold gradient-text">MasterPlan</a>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="dashboard.html" class="text-gray-700 hover:text-gray-900 font-medium transition-colors">Dashboard</a>
                    <a href="simulator.html" class="text-gray-900 font-semibold border-b-2 border-indigo-600 pb-1">Simulator</a>
                    <a href="pricing.html" class="text-gray-700 hover:text-gray-900 font-medium transition-colors">Pricing</a>
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 font-semibold">
                            G
                        </div>
                        <span class="font-medium text-gray-700">Guest</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-6 py-12" id="main-content">
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Create Your Financial Plan</h1>
            <p class="text-xl text-gray-600">Follow these simple steps to calculate your funding gap</p>
        </div>

        <!-- Progress Bar -->
        <div class="bg-white rounded-2xl border border-gray-200 p-6 mb-8 shadow-sm">
            <div class="flex justify-around flex-wrap gap-2">
                <div class="step-indicator" id="step-0-indicator">0. Search Method</div>
                <div class="step-indicator" id="step-1-indicator">1. Programs</div>
                <div class="step-indicator" id="step-2-indicator">2. Funds</div>
                <div class="step-indicator" id="step-3-indicator">3. Lifestyle</div>
                <div class="step-indicator" id="step-4-indicator">4. Income</div>
            </div>
        </div>

        <!-- Step 0: Search Method -->
        <section id="step-0" class="bg-white rounded-2xl border border-gray-200 p-8 mb-8 shadow-sm">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">How would you like to search?</h2>
            <p class="text-gray-600 mb-8 text-center">Choose your preferred search method to find programs</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
                <div class="card-selectable" onclick="selectSearchMethod('country', this)">
                    <div class="text-5xl mb-4">üåç</div>
                    <h3 class="text-xl font-bold mb-2">By Country</h3>
                    <p class="text-sm text-gray-600">Start with a country, then select university and program</p>
                </div>
                <div class="card-selectable" onclick="selectSearchMethod('university', this)">
                    <div class="text-5xl mb-4">üèõÔ∏è</div>
                    <h3 class="text-xl font-bold mb-2">By University</h3>
                    <p class="text-sm text-gray-600">Start with a university, then select program</p>
                </div>
                <div class="card-selectable" onclick="selectSearchMethod('program', this)">
                    <div class="text-5xl mb-4">üìö</div>
                    <h3 class="text-xl font-bold mb-2">By Program</h3>
                    <p class="text-sm text-gray-600">Start with a program, then select country and university</p>
                </div>
            </div>
        </section>

        <!-- Step 1: Programs -->
        <section id="step-1" class="bg-white rounded-2xl border border-gray-200 p-8 mb-8 shadow-sm hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Step 1: Select Your Programs</h2>
            
            <!-- Dynamic Search Fields Based on Method -->
            <div id="search-fields-container" class="space-y-6 mb-6">
                <!-- Fields will be dynamically inserted here -->
            </div>
            
            <!-- Selected Programs -->
            <div id="selectedPrograms" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"></div>
            
            <p id="emptyState" class="text-center text-gray-500 py-8 border-2 border-dashed border-gray-200 rounded-xl">
                Select your search criteria to find programs
            </p>
        </section>
        
        <script>
            // Global state
            window.searchMethod = null;
            window.selectedPrograms = [];
            window.selectedCountry = null;
            window.selectedUniversity = null;
            window.selectedProgram = null;
            
            // Countries database (25-30 top countries)
            const countries = [
                { code: 'US', name: 'United States', livingCost: 1500 },
                { code: 'UK', name: 'United Kingdom', livingCost: 1400 },
                { code: 'CA', name: 'Canada', livingCost: 1200 },
                { code: 'AU', name: 'Australia', livingCost: 1300 },
                { code: 'NZ', name: 'New Zealand', livingCost: 1100 },
                { code: 'DE', name: 'Germany', livingCost: 1000 },
                { code: 'FR', name: 'France', livingCost: 1200 },
                { code: 'ES', name: 'Spain', livingCost: 900 },
                { code: 'IT', name: 'Italy', livingCost: 950 },
                { code: 'NL', name: 'Netherlands', livingCost: 1100 },
                { code: 'CH', name: 'Switzerland', livingCost: 1600 },
                { code: 'SE', name: 'Sweden', livingCost: 1200 },
                { code: 'NO', name: 'Norway', livingCost: 1400 },
                { code: 'DK', name: 'Denmark', livingCost: 1300 },
                { code: 'FI', name: 'Finland', livingCost: 1100 },
                { code: 'BE', name: 'Belgium', livingCost: 1050 },
                { code: 'AT', name: 'Austria', livingCost: 1000 },
                { code: 'IE', name: 'Ireland', livingCost: 1250 },
                { code: 'PT', name: 'Portugal', livingCost: 850 },
                { code: 'MX', name: 'Mexico', livingCost: 700 },
                { code: 'BR', name: 'Brazil', livingCost: 650 },
                { code: 'AR', name: 'Argentina', livingCost: 600 },
                { code: 'JP', name: 'Japan', livingCost: 1300 },
                { code: 'CN', name: 'China', livingCost: 800 },
                { code: 'HK', name: 'Hong Kong', livingCost: 1500 },
                { code: 'SG', name: 'Singapore', livingCost: 1400 },
                { code: 'RU', name: 'Russia', livingCost: 600 }
            ];
            
            // Programs database (80-100 common graduate programs)
            const programs = [
                'MBA', 'Master of Finance', 'Master of Accounting', 'Master in Management',
                'Master of Marketing', 'Master of Business Analytics', 'Master of Data Science',
                'Master of Computer Science', 'Master of Information Systems', 'Master of Engineering',
                'Master of Civil Engineering', 'Master of Mechanical Engineering', 'Master of Electrical Engineering',
                'Master of Chemical Engineering', 'Master of Aerospace Engineering', 'Master of Biomedical Engineering',
                'Master of Economics', 'Master of Public Policy', 'Master of International Relations',
                'Master of Law (LLM)', 'Master of Public Health', 'Master of Social Work',
                'Master of Education', 'Master of Psychology', 'Master of Clinical Psychology',
                'Master of Architecture', 'Master of Urban Planning', 'Master of Design',
                'Master of Fine Arts', 'Master of Journalism', 'Master of Communications',
                'Master of Public Administration', 'Master of Healthcare Administration', 'Master of Supply Chain',
                'Master of Operations Management', 'Master of Human Resources', 'Master of Entrepreneurship',
                'Master of Innovation', 'Master of Sustainability', 'Master of Environmental Science',
                'Master of Biotechnology', 'Master of Pharmaceutical Sciences', 'Master of Nursing',
                'Master of Medicine', 'Master of Dentistry', 'Master of Veterinary Medicine',
                'Master of Agriculture', 'Master of Food Science', 'Master of Nutrition',
                'Master of Sports Management', 'Master of Hospitality', 'Master of Tourism',
                'Master of Real Estate', 'Master of Construction Management', 'Master of Project Management',
                'Master of Quality Management', 'Master of Risk Management', 'Master of Insurance',
                'Master of Actuarial Science', 'Master of Statistics', 'Master of Mathematics',
                'Master of Physics', 'Master of Chemistry', 'Master of Biology',
                'Master of Genetics', 'Master of Neuroscience', 'Master of Cognitive Science',
                'Master of Linguistics', 'Master of Literature', 'Master of History',
                'Master of Philosophy', 'Master of Theology', 'Master of Religious Studies',
                'Master of Anthropology', 'Master of Sociology', 'Master of Political Science',
                'Master of Geography', 'Master of Geology', 'Master of Oceanography',
                'Master of Meteorology', 'Master of Astronomy', 'Master of Astrophysics',
                'Master of Materials Science', 'Master of Nanotechnology', 'Master of Robotics',
                'Master of Artificial Intelligence', 'Master of Machine Learning', 'Master of Cybersecurity',
                'Master of Digital Marketing', 'Master of E-commerce', 'Master of Fintech'
            ];
            
            // Initialize step 0 as active
            document.getElementById('step-0-indicator').classList.add('active');
            
            // Universities database - comprehensive list by country
            function generateUniversitiesDatabase() {
                const universitiesData = [];
                
                // USA Universities (22 top universities)
                const usaUnis = [
                    'Harvard University', 'Stanford University', 'MIT', 'University of Pennsylvania (Wharton)', 
                    'Columbia University', 'University of Chicago (Booth)', 'Northwestern University (Kellogg)',
                    'Yale University', 'Duke University (Fuqua)', 'University of California, Berkeley (Haas)',
                    'University of Michigan (Ross)', 'Cornell University (Johnson)', 'UCLA (Anderson)',
                    'New York University (Stern)', 'Carnegie Mellon University (Tepper)', 'University of Texas (McCombs)',
                    'University of Virginia (Darden)', 'Georgetown University (McDonough)', 'Vanderbilt University (Owen)',
                    'Emory University (Goizueta)', 'University of North Carolina (Kenan-Flagler)', 'Indiana University (Kelley)'
                ];
                
                // UK Universities
                const ukUnis = [
                    'University of Oxford', 'University of Cambridge', 'London Business School', 'Imperial College London',
                    'London School of Economics', 'University of Warwick', 'University of Manchester', 'University of Edinburgh',
                    'King\'s College London', 'University of Bristol', 'Durham University', 'University of Leeds'
                ];
                
                // European Universities by country
                const europeUnis = {
                    'ES': ['IE Business School', 'ESADE Business School', 'IESE Business School', 'Universidad Carlos III de Madrid'],
                    'FR': ['INSEAD', 'HEC Paris', 'ESSEC Business School', 'Sciences Po Paris'],
                    'DE': ['WHU - Otto Beisheim School', 'Mannheim Business School', 'Frankfurt School of Finance', 'ESMT Berlin'],
                    'NL': ['Rotterdam School of Management', 'Amsterdam Business School', 'Maastricht University'],
                    'CH': ['University of St. Gallen', 'IMD Business School', 'University of Zurich'],
                    'IT': ['Bocconi University', 'SDA Bocconi', 'MIB School of Management'],
                    'SE': ['Stockholm School of Economics', 'Lund University', 'Uppsala University'],
                    'NO': ['BI Norwegian Business School', 'NHH Norwegian School of Economics'],
                    'DK': ['Copenhagen Business School', 'Aarhus University'],
                    'FI': ['Aalto University', 'Hanken School of Economics'],
                    'BE': ['Vlerick Business School', 'Solvay Brussels School'],
                    'AT': ['Vienna University of Economics', 'WU Vienna'],
                    'IE': ['Trinity College Dublin', 'University College Dublin'],
                    'PT': ['Nova School of Business', 'Cat√≥lica Lisbon School']
                };
                
                // Other countries
                const otherUnis = {
                    'CA': ['University of Toronto (Rotman)', 'Western University (Ivey)', 'McGill University', 'University of British Columbia (Sauder)'],
                    'AU': ['University of Melbourne', 'University of Sydney', 'Australian National University', 'UNSW Sydney'],
                    'NZ': ['University of Auckland', 'University of Otago', 'Victoria University of Wellington'],
                    'MX': ['EGADE Business School', 'IPADE Business School', 'Tecnol√≥gico de Monterrey'],
                    'BR': ['Funda√ß√£o Getulio Vargas', 'INSPER', 'IBMEC'],
                    'AR': ['Universidad de Buenos Aires', 'Universidad Torcuato di Tella'],
                    'JP': ['University of Tokyo', 'Waseda University', 'Keio University'],
                    'CN': ['Tsinghua University', 'Peking University', 'Fudan University'],
                    'HK': ['University of Hong Kong', 'Hong Kong University of Science and Technology', 'Chinese University of Hong Kong'],
                    'SG': ['National University of Singapore', 'Nanyang Technological University', 'Singapore Management University'],
                    'RU': ['Moscow State University', 'St. Petersburg State University', 'Higher School of Economics']
                };
                
                // Generate combinations for each program
                programs.forEach(program => {
                    // USA
                    usaUnis.forEach(uni => {
                        const tuition = Math.floor(Math.random() * 80000) + 60000;
                        const duration = [12, 15, 18, 21, 24][Math.floor(Math.random() * 5)];
                        universitiesData.push({
                            name: uni,
                            country: 'US',
                            countryName: 'United States',
                            program: program,
                            tuition: tuition,
                            duration: duration,
                            livingCost: 1500
                        });
                    });
                    
                    // UK
                    ukUnis.forEach(uni => {
                        const tuition = Math.floor(Math.random() * 50000) + 40000;
                        const duration = [12, 15, 18, 21][Math.floor(Math.random() * 4)];
                        universitiesData.push({
                            name: uni,
                            country: 'UK',
                            countryName: 'United Kingdom',
                            program: program,
                            tuition: tuition,
                            duration: duration,
                            livingCost: 1400
                        });
                    });
                    
                    // Europe
                    Object.keys(europeUnis).forEach(countryCode => {
                        const country = countries.find(c => c.code === countryCode);
                        if (country) {
                            europeUnis[countryCode].forEach(uni => {
                                const baseTuition = country.livingCost * 40;
                                const tuition = Math.floor(baseTuition * (0.8 + Math.random() * 0.4));
                                const duration = [10, 12, 15, 18][Math.floor(Math.random() * 4)];
                                universitiesData.push({
                                    name: uni,
                                    country: countryCode,
                                    countryName: country.name,
                                    program: program,
                                    tuition: tuition,
                                    duration: duration,
                                    livingCost: country.livingCost
                                });
                            });
                        }
                    });
                    
                    // Other countries
                    Object.keys(otherUnis).forEach(countryCode => {
                        const country = countries.find(c => c.code === countryCode);
                        if (country) {
                            otherUnis[countryCode].forEach(uni => {
                                const baseTuition = country.livingCost * 40;
                                const tuition = Math.floor(baseTuition * (0.8 + Math.random() * 0.4));
                                const duration = [12, 15, 18, 21][Math.floor(Math.random() * 4)];
                                universitiesData.push({
                                    name: uni,
                                    country: countryCode,
                                    countryName: country.name,
                                    program: program,
                                    tuition: tuition,
                                    duration: duration,
                                    livingCost: country.livingCost
                                });
                            });
                        }
                    });
                });
                
                return universitiesData;
            }
            
            const universitiesDatabase = generateUniversitiesDatabase();
            
            // Function to select search method
            function selectSearchMethod(method, element) {
                document.querySelectorAll('#step-0 .card-selectable').forEach(card => {
                    card.classList.remove('selected');
                });
                element.classList.add('selected');
                
                window.searchMethod = method;
                document.getElementById('step-0-indicator').classList.add('active');
                document.getElementById('step-1-indicator').classList.add('active');
                
                document.getElementById('step-0').classList.add('hidden');
                document.getElementById('step-1').classList.remove('hidden');
                
                renderSearchFields(method);
            }
            
            function renderSearchFields(method) {
                const container = document.getElementById('search-fields-container');
                container.innerHTML = '';
                
                if (method === 'country') {
                    container.innerHTML = `
                        <div class="space-y-2 relative">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Select Country</label>
                            <select id="search-country" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-600 focus:ring-2 focus:ring-indigo-100 transition-all" onchange="onCountrySelected()">
                                <option value="">Select a country</option>
                                ${countries.map(c => `<option value="${c.code}">${c.name}</option>`).join('')}
                            </select>
                        </div>
                        <div id="university-field" class="space-y-2 relative hidden">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Select University</label>
                            <select id="search-university" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-600 focus:ring-2 focus:ring-indigo-100 transition-all" onchange="onUniversitySelected()">
                                <option value="">Select a university</option>
                            </select>
                        </div>
                        <div id="program-field" class="space-y-2 relative hidden">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Select Program</label>
                            <select id="search-program" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-600 focus:ring-2 focus:ring-indigo-100 transition-all" onchange="onProgramSelected()">
                                <option value="">Select a program</option>
                            </select>
                        </div>
                    `;
                } else if (method === 'university') {
                    container.innerHTML = `
                        <div class="space-y-2 relative">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Search University</label>
                            <input type="text" id="search-university-input" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-600 focus:ring-2 focus:ring-indigo-100 transition-all" placeholder="Start typing university name..." autocomplete="off" oninput="searchUniversity(this.value)">
                            <div id="university-results" class="search-dropdown hidden"></div>
                        </div>
                        <div id="program-field" class="space-y-2 relative hidden mt-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Select Program</label>
                            <select id="search-program" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-600 focus:ring-2 focus:ring-indigo-100 transition-all" onchange="onProgramSelected()">
                                <option value="">Select a program</option>
                            </select>
                        </div>
                    `;
                } else if (method === 'program') {
                    container.innerHTML = `
                        <div class="space-y-2 relative">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Select Program</label>
                            <select id="search-program" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-600 focus:ring-2 focus:ring-indigo-100 transition-all" onchange="onProgramSelected()">
                                <option value="">Select a program</option>
                                ${programs.map(p => `<option value="${p}">${p}</option>`).join('')}
                            </select>
                        </div>
                        <div id="country-field" class="space-y-2 relative hidden mt-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Select Country</label>
                            <select id="search-country" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-600 focus:ring-2 focus:ring-indigo-100 transition-all" onchange="onCountrySelected()">
                                <option value="">Select a country</option>
                                ${countries.map(c => `<option value="${c.code}">${c.name}</option>`).join('')}
                            </select>
                        </div>
                        <div id="university-field" class="space-y-2 relative hidden mt-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Select University</label>
                            <select id="search-university" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-600 focus:ring-2 focus:ring-indigo-100 transition-all" onchange="onUniversitySelected()">
                                <option value="">Select a university</option>
                            </select>
                        </div>
                    `;
                }
            }
            
            window.onCountrySelected = function() {
                const countryCode = document.getElementById('search-country').value;
                if (!countryCode) return;
                window.selectedCountry = countryCode;
                const countryUnis = [...new Set(universitiesDatabase.filter(u => u.country === countryCode).map(u => u.name))];
                const universitySelect = document.getElementById('search-university');
                if (universitySelect) {
                    universitySelect.innerHTML = '<option value="">Select a university</option>' + countryUnis.map(uni => `<option value="${uni}">${uni}</option>`).join('');
                    document.getElementById('university-field').classList.remove('hidden');
                }
                if (window.searchMethod === 'program' && window.selectedProgram) {
                    filterProgramsByCountryAndProgram();
                }
            };
            
            window.onUniversitySelected = function() {
                const universityName = document.getElementById('search-university')?.value || document.getElementById('search-university-input')?.value;
                if (!universityName) return;
                window.selectedUniversity = universityName;
                const uniPrograms = [...new Set(universitiesDatabase.filter(u => u.name === universityName).map(u => u.program))];
                const programSelect = document.getElementById('search-program');
                if (programSelect) {
                    programSelect.innerHTML = '<option value="">Select a program</option>' + uniPrograms.map(p => `<option value="${p}">${p}</option>`).join('');
                    document.getElementById('program-field').classList.remove('hidden');
                }
            };
            
            window.onProgramSelected = function() {
                const programName = document.getElementById('search-program').value;
                if (!programName) return;
                window.selectedProgram = programName;
                if (window.searchMethod === 'country') {
                    showMatchingPrograms();
                } else if (window.searchMethod === 'university') {
                    showMatchingPrograms();
                } else if (window.searchMethod === 'program') {
                    document.getElementById('country-field').classList.remove('hidden');
                }
            };
            
            window.searchUniversity = function(query) {
                if (query.length < 2) {
                    document.getElementById('university-results').classList.add('hidden');
                    return;
                }
                const filtered = [...new Set(universitiesDatabase.map(u => u.name).filter(name => name.toLowerCase().includes(query.toLowerCase())).slice(0, 10))];
                const resultsDiv = document.getElementById('university-results');
                if (filtered.length === 0) {
                    resultsDiv.innerHTML = '<div class="search-result p-4 text-center text-gray-500">No universities found</div>';
                } else {
                    resultsDiv.innerHTML = filtered.map(uni => `<div class="search-result" onclick="selectUniversityFromSearch('${uni.replace(/'/g, "\\'")}')"><div class="font-bold text-gray-900">${uni}</div></div>`).join('');
                }
                resultsDiv.classList.remove('hidden');
            };
            
            window.selectUniversityFromSearch = function(uniName) {
                document.getElementById('search-university-input').value = uniName;
                window.selectedUniversity = uniName;
                document.getElementById('university-results').classList.add('hidden');
                onUniversitySelected();
            };
            
            function filterProgramsByCountryAndProgram() {
                if (!window.selectedCountry || !window.selectedProgram) return;
                const matchingUnis = [...new Set(universitiesDatabase.filter(u => u.country === window.selectedCountry && u.program === window.selectedProgram).map(u => u.name))];
                const universitySelect = document.getElementById('search-university');
                if (universitySelect) {
                    universitySelect.innerHTML = '<option value="">Select a university</option>' + matchingUnis.map(uni => `<option value="${uni}">${uni}</option>`).join('');
                    document.getElementById('university-field').classList.remove('hidden');
                }
            }
            
            function showMatchingPrograms() {
                let matching = universitiesDatabase;
                if (window.selectedCountry) matching = matching.filter(u => u.country === window.selectedCountry);
                if (window.selectedUniversity) matching = matching.filter(u => u.name === window.selectedUniversity);
                if (window.selectedProgram) matching = matching.filter(u => u.program === window.selectedProgram);
                
                matching.forEach(program => {
                    if (!window.selectedPrograms.find(p => p.name === program.name && p.program === program.program && p.country === program.country)) {
                        window.selectedPrograms.push({
                            name: program.name,
                            location: `${program.countryName} - ${program.name}`,
                            tuition: `$${program.tuition.toLocaleString()}`,
                            duration: `${program.duration} months`,
                            program: program.program,
                            country: program.country,
                            countryName: program.countryName,
                            livingCost: program.livingCost,
                            tuitionNum: program.tuition,
                            durationNum: program.duration
                        });
                    }
                });
                
                document.getElementById('emptyState').classList.add('hidden');
                renderSelectedPrograms();
            }
            
            function removeProgram(index) {
                window.selectedPrograms.splice(index, 1);
                if (window.selectedPrograms.length === 0) {
                    document.getElementById('emptyState').classList.remove('hidden');
                }
                renderSelectedPrograms();
            }
            
            function renderSelectedPrograms() {
                const container = document.getElementById('selectedPrograms');
                if (window.selectedPrograms.length === 0) {
                    container.innerHTML = '';
                    return;
                }
                container.innerHTML = window.selectedPrograms.map((program, index) => `
                    <div class="selected-program">
                        <span class="remove-program" onclick="removeProgram(${index})">√ó</span>
                        <div class="font-bold text-lg text-gray-900 mb-1">${program.name}</div>
                        <div class="text-sm text-gray-600 mb-2">${program.location}</div>
                        <div class="flex justify-between items-center mt-3 pt-3 border-t border-gray-200">
                            <span class="font-bold text-red-600 text-lg">${program.tuition}</span>
                            <span class="text-sm text-gray-500">${program.duration}</span>
                        </div>
                        <div class="text-xs text-gray-500 mt-2">${program.program}</div>
                    </div>
                `).join('');
                window.removeProgram = removeProgram;
            }
            
            window.selectSearchMethod = selectSearchMethod;
        </script>

        <!-- Step 2: Funds -->
        <section class="bg-white rounded-2xl border border-gray-200 p-8 mb-8 shadow-sm">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Step 2: Enter Your Available Funds</h2>
            <div class="max-w-md mx-auto space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">My Personal Savings ($)</label>
                    <input type="text" id="input-savings" placeholder="Enter amount" />
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Family Contribution ($)</label>
                    <input type="text" id="input-family" placeholder="Enter amount" />
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Confirmed Scholarships ($)</label>
                    <input type="text" id="input-scholarships" placeholder="Enter amount" />
                </div>
            </div>
        </section>

        <!-- Step 3: Lifestyle -->
        <section class="bg-white rounded-2xl border border-gray-200 p-8 mb-8 shadow-sm">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">Step 3: Define Your Lifestyle</h2>
            <p class="text-gray-600 mb-6 text-center">How do you plan to live during your studies?</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card-selectable" onclick="selectLifestyle('frugal', this)">
                    <div class="text-4xl mb-3">üéí</div>
                    <h3 class="text-xl font-bold mb-2">Frugal Student</h3>
                    <p class="text-sm text-gray-600">Estimated ~$900/mo</p>
                </div>
                <div class="card-selectable selected" onclick="selectLifestyle('balanced', this)">
                    <div class="text-4xl mb-3">‚òï</div>
                    <h3 class="text-xl font-bold mb-2">Balanced</h3>
                    <p class="text-sm text-gray-600">Estimated ~$1,400/mo</p>
                </div>
                <div class="card-selectable" onclick="selectLifestyle('comfortable', this)">
                    <div class="text-4xl mb-3">üçΩÔ∏è</div>
                    <h3 class="text-xl font-bold mb-2">Comfortable</h3>
                    <p class="text-sm text-gray-600">Estimated ~$2,100/mo</p>
                </div>
            </div>
        </section>

        <!-- Step 4: Income -->
        <section class="bg-white rounded-2xl border border-gray-200 p-8 mb-8 shadow-sm">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Step 4: Will You Have Additional Income?</h2>
            
            <div class="space-y-8">
                <!-- Home Country Salary -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-4">Will you maintain your salary from your home country?</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="card-selectable" onclick="selectSalary('yes', this)">
                            <div class="text-3xl mb-2">‚úì</div>
                            <div class="font-semibold text-gray-900">Yes</div>
                            <p class="text-sm text-gray-600 mt-1">Continue earning</p>
                        </div>
                        <div class="card-selectable selected" onclick="selectSalary('no', this)">
                            <div class="text-3xl mb-2">‚úó</div>
                            <div class="font-semibold text-gray-900">No</div>
                            <p class="text-sm text-gray-600 mt-1">No home salary</p>
                        </div>
                    </div>
                </div>
                <div id="salary-amount-group" class="hidden">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Monthly Salary from Home Country ($)</label>
                    <input type="text" id="input-home-salary" placeholder="Enter monthly amount in USD" />
                </div>
                
                <!-- On-Campus Job -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-4">Will you have an on-campus job?</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="card-selectable" onclick="selectOnCampus('yes', this)">
                            <div class="text-3xl mb-2">‚úì</div>
                            <div class="font-semibold text-gray-900">Yes</div>
                            <p class="text-sm text-gray-600 mt-1">Work on campus</p>
                        </div>
                        <div class="card-selectable selected" onclick="selectOnCampus('no', this)">
                            <div class="text-3xl mb-2">‚úó</div>
                            <div class="font-semibold text-gray-900">No</div>
                            <p class="text-sm text-gray-600 mt-1">No on-campus job</p>
                        </div>
                    </div>
                </div>
                <div id="oncampus-details-group" class="hidden space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Hours per Week (max 20)</label>
                        <input type="number" id="input-hours-week" min="0" max="20" placeholder="Max 20 hours/week" />
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Hourly Rate ($)</label>
                        <input type="text" id="input-hourly-rate" placeholder="Enter rate per hour" />
                    </div>
                </div>
            </div>
        </section>
        
        <script>
            window.selectedSalary = 'no';
            window.selectedOnCampus = 'no';

            function selectSalary(type, element) {
                const salarySection = element.closest('section').querySelector('.grid');
                if (salarySection) {
                    salarySection.querySelectorAll('.card-selectable').forEach(card => {
                        card.classList.remove('selected');
                    });
                }
                element.classList.add('selected');
                window.selectedSalary = type;
                document.getElementById('salary-amount-group').classList.toggle('hidden', type !== 'yes');
            }

            function selectOnCampus(type, element) {
                const oncampusSection = element.closest('section').querySelectorAll('.grid')[1];
                if (oncampusSection) {
                    oncampusSection.querySelectorAll('.card-selectable').forEach(card => {
                        card.classList.remove('selected');
                    });
                }
                element.classList.add('selected');
                window.selectedOnCampus = type;
                document.getElementById('oncampus-details-group').classList.toggle('hidden', type !== 'yes');
            }

            function selectLifestyle(type, element) {
                const lifestyleSection = element.closest('section');
                if (lifestyleSection) {
                    lifestyleSection.querySelectorAll('.card-selectable').forEach(card => {
                        card.classList.remove('selected');
                    });
                }
                element.classList.add('selected');
                window.selectedLifestyle = type;
            }
            
            function calculatePlan() {
                const programs = window.selectedPrograms || [];
                if (programs.length === 0) {
                    alert('Please select at least one university');
                    return;
                }
                
                const savings = parseFloat(document.getElementById('input-savings').value) || 0;
                const family = parseFloat(document.getElementById('input-family').value) || 0;
                const scholarships = parseFloat(document.getElementById('input-scholarships').value) || 0;
                
                const lifestyle = window.selectedLifestyle || 'balanced';
                const lifestyleMap = {
                    'frugal': 900,
                    'balanced': 1400,
                    'comfortable': 2100
                };
                const monthlyLiving = lifestyleMap[lifestyle] || 1400;
                
                const hasHomeSalary = window.selectedSalary === 'yes';
                const homeSalaryMonthly = hasHomeSalary ? parseFloat(document.getElementById('input-home-salary').value) || 0 : 0;
                
                const hasOnCampusJob = window.selectedOnCampus === 'yes';
                const hoursPerWeek = hasOnCampusJob ? parseFloat(document.getElementById('input-hours-week').value) || 0 : 0;
                const hourlyRate = hasOnCampusJob ? parseFloat(document.getElementById('input-hourly-rate').value) || 0 : 0;
                const monthlyOnCampusIncome = hoursPerWeek * hourlyRate * 4;
                
                const totalMonthlyIncome = homeSalaryMonthly + monthlyOnCampusIncome;
                
                const program = programs[0];
                // Use tuitionNum and durationNum if available, otherwise parse from strings
                const tuition = program.tuitionNum || parseInt(program.tuition.replace('$', '').replace(/,/g, '')) || 0;
                const durationMonths = program.durationNum || parseInt(program.duration.replace(' months', '').replace(' month', '')) || 12;
                
                // Use country living cost if available, otherwise use lifestyle estimate
                const countryLivingCost = program.livingCost || monthlyLiving;
                const adjustedMonthlyLiving = Math.max(monthlyLiving, countryLivingCost * 0.7); // Use higher of lifestyle or 70% of country base
                
                const totalPersonalFunds = savings + family + scholarships;
                const totalLivingCost = adjustedMonthlyLiving * durationMonths;
                const totalTuition = tuition;
                const totalCost = totalTuition + totalLivingCost;
                const fundingGap = totalCost - totalPersonalFunds;
                
                const params = new URLSearchParams({
                    simType: 'single',
                    nameA: program.name,
                    tuitionA: tuition,
                    livingA: totalLivingCost,
                    costA: totalCost,
                    gapA: fundingGap,
                    savings: savings,
                    family: family,
                    scholarships: scholarships,
                    lifestyle: lifestyle,
                    monthlyLiving: monthlyLiving,
                    duration: durationMonths,
                    hasHomeSalary: hasHomeSalary,
                    homeSalaryMonthly: homeSalaryMonthly,
                    hasOnCampusJob: hasOnCampusJob,
                    hoursPerWeek: hoursPerWeek,
                    hourlyRate: hourlyRate,
                    monthlyOnCampusIncome: monthlyOnCampusIncome,
                    totalMonthlyIncome: totalMonthlyIncome
                });
                
                window.location.href = `results.html?${params.toString()}`;
            }
        </script>
        
        <!-- Final CTA -->
        <div class="text-center pt-8">
            <button onclick="calculatePlan()" class="gradient-bg text-white px-12 py-4 rounded-xl font-bold text-xl hover:shadow-2xl transition-all transform hover:-translate-y-1">
                Calculate My Plan
            </button>
        </div>
    </main>
</body>
</html>
